<!DOCTYPE html>
<html>
	<head>
		<title>Physics Easily</title>
		<meta charset="utf-8"> 
		<link rel = "stylesheet" type = "text/css" href = "css/united.css">
		<!---<meta name="viewport" content="width=device-width, initial-scale=1">-->
                <title>Box2D Javascript Fun : 15 : Box2D with Pulley Joints and HTML5 Canvas</title>
                <link rel="author" href="http://profiles.google.com/sethladd">
                <script src="js/BoxZD/js/Box2D.js"></script>
                <script src="js/BoxZD/Pully_joint/pully_joint.js"></script>
                <style>
    body {
      -webkit-transform: translateZ(0);
    }
    </style>
	</head>
	<body>
		<script src = "http://code.jquery.com/jquery-1.10.1.min.js"> </script>
		<script src = "js/bootstrap.js"> </script>

		<div class="”container”" style = "font-family: 'Museo Slab'">
			<!---<h1><a href="”#”">Physics-Easily</a></h1>-->
			<!--- Nav bar -->
			<div class="navbar navbar-default">
  			<div class="navbar-header">
    			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      				<span class="icon-bar"></span>
      				<span class="icon-bar"></span>
      				<span class="icon-bar"></span>
    			</button>
    			<a class="navbar-brand" href="#">Physics-Easily</a>
  			</div>
  			<div class="navbar-collapse collapse navbar-responsive-collapse" >
    			<ul class="nav navbar-nav">
      				<li class="active"><a href="#">Home</a></li>
      				<li class="dropdown">
      				  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<b class="caret"></b></a>
      				  <ul class="dropdown-menu">
      				    <li><a href="#">Action</a></li>
      				    <li><a href="#">Another action</a></li>
      				    <li><a href="#">Something else here</a></li>
      				    <li class="divider"></li>
      				    <li class="dropdown-header">Dropdown header</li>
      				    <li><a href="#">Separated link</a></li>
      				    <li><a href="#">One more separated link</a></li>
      				  </ul>
      				</li>
    			</ul>
    			<form class="navbar-form navbar-left">
      				<input type="text" class="form-control col-lg-8" placeholder="Search">
    			</form>
    			<ul class="nav navbar-nav navbar-right">
      				<li><a href="login.html" target="_blank">LOGIN</a></li>
      				<li><a href="signup.html">Sign Up</a></li>
    			</ul>
  			</div>
			</div>

 <img class="pos_fixed" border="0" src="img/P4.jpg" alt="Pulpit rock" width="100" height="500">

<style>

.pos_fixed
{
position:fixed;
top:55px;
right:50px;
}
.pos_left
{
position:relative;
left:-20px;
}

.pos_right
{
position:relative;
left:20px;
}
</style>
<canvas id="c0" width="1100" height="500" style="border:4px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>


    <h1>Box2D with Pulley Joint and HTML5 Canvas</h1>
    
    <p>
      Black dot is the position of the object, the yellow dot is the center of mass.
    </p>
    
    <script async>
    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/
    window.requestAnimFrame = (function(){
          return  window.requestAnimationFrame       || 
                  window.webkitRequestAnimationFrame || 
                  window.mozRequestAnimationFrame    || 
                  window.oRequestAnimationFrame      || 
                  window.msRequestAnimationFrame     || 
                  function(/* function */ callback, /* DOMElement */ element){
                    window.setTimeout(callback, 1000 / 60);
                  };
    })();
    </script>
    
    <script async>

    var SCALE = 30;
    var NULL_CENTER = {x:null, y:null};
    
    function PulleyJoint(entity1, entity2, anchor1, anchor2) {
      this.entity1 = entity1;
      this.entity2 = entity2;
      this.anchor1 = anchor1;
      this.anchor2 = anchor2;
    }
    
    PulleyJoint.prototype.draw = function(ctx) {
      this.drawLine(ctx, this.entity1, this.anchor1);
      this.drawLine(ctx, this.entity2, this.anchor2);
    }
    
    PulleyJoint.prototype.drawLine = function(ctx, entity, anchor) {
      ctx.beginPath();
      ctx.strokeStyle = 'black';
      ctx.moveTo(entity.x * SCALE, entity.y * SCALE);
      ctx.lineTo(anchor.x * SCALE, anchor.y * SCALE);
      ctx.closePath();
      ctx.stroke();
    }
    
    function Entity(id, x, y, angle, center, color) {
      this.id = id;
      this.x = x;
      this.y = y;
      this.angle = angle || 0;
      this.center = center;
      this.color = color || "red";
    }
    
    Entity.prototype.update = function(state) {
      this.x = state.x;
      this.y = state.y;
      this.center = state.c;
      this.angle = state.a;
    }
    
    Entity.prototype.draw = function(ctx) {
      ctx.fillStyle = 'black';
      ctx.beginPath();
      ctx.arc(this.x * SCALE, this.y * SCALE, 4, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
      
      ctx.fillStyle = 'yellow';
      ctx.beginPath();
      ctx.arc(this.center.x * SCALE, this.center.y * SCALE, 2, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
    }
    
    Entity.build = function(def) {
      if (def.radius) {
        return new CircleEntity(def.id, def.x, def.y, def.angle, NULL_CENTER, def.color, def.radius);
      } else if (def.polys) {
        return new PolygonEntity(def.id, def.x, def.y, def.angle, NULL_CENTER, def.color, def.polys);
      } else {
        return new RectangleEntity(def.id, def.x, def.y, def.angle, NULL_CENTER, def.color, def.halfWidth, def.halfHeight);
      }
    }
    
    function CircleEntity(id, x, y, angle, center, color, radius) {
      color = color || 'aqua';
      Entity.call(this, id, x, y, angle, center, color);
      this.radius = radius;
    }
    CircleEntity.prototype = new Entity();
    CircleEntity.prototype.constructor = CircleEntity;
    
    CircleEntity.prototype.draw = function(ctx) {
      ctx.save();
      ctx.translate(this.x * SCALE, this.y * SCALE);
      ctx.rotate(this.angle);
      ctx.translate(-(this.x) * SCALE, -(this.y) * SCALE);
      
      ctx.fillStyle = this.color;
      ctx.strokeStyle = 'black';
      ctx.beginPath();
      ctx.arc(this.x * SCALE, this.y * SCALE, this.radius * SCALE, 0, Math.PI * 2, true);
      ctx.moveTo(this.x * SCALE, this.y * SCALE);
      ctx.lineTo((this.x) * SCALE, (this.y + this.radius) * SCALE);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      
      ctx.restore();
      
      Entity.prototype.draw.call(this, ctx);
    }
    
    function RectangleEntity(id, x, y, angle, center, color, halfWidth, halfHeight) {
      Entity.call(this, id, x, y, angle, center, color);
      this.halfWidth = halfWidth;
      this.halfHeight = halfHeight;
    }
    RectangleEntity.prototype = new Entity();
    RectangleEntity.prototype.constructor = RectangleEntity;
    
    RectangleEntity.prototype.draw = function(ctx) {
      ctx.save();
      ctx.translate(this.x * SCALE, this.y * SCALE);
      ctx.rotate(this.angle);
      ctx.translate(-(this.x) * SCALE, -(this.y) * SCALE);
      ctx.fillStyle = this.color;
      ctx.fillRect((this.x-this.halfWidth) * SCALE,
                   (this.y-this.halfHeight) * SCALE,
                   (this.halfWidth*2) * SCALE,
                   (this.halfHeight*2) * SCALE);
      ctx.restore();
      
      Entity.prototype.draw.call(this, ctx);
    }
    
    function PolygonEntity(id, x, y, angle, center, color, polys) {
      Entity.call(this, id, x, y, angle, center, color);
      this.polys = polys;
    }
    PolygonEntity.prototype = new Entity();
    PolygonEntity.prototype.constructor = PolygonEntity;
    
    PolygonEntity.prototype.draw = function(ctx) {
      ctx.save();
      ctx.translate(this.x * SCALE, this.y * SCALE);
      ctx.rotate(this.angle);
      ctx.translate(-(this.x) * SCALE, -(this.y) * SCALE);
      ctx.fillStyle = this.color;

      for (var i = 0; i < this.polys.length; i++) {
        var points = this.polys[i];
        ctx.beginPath();
        ctx.moveTo((this.x + points[0].x) * SCALE, (this.y + points[0].y) * SCALE);
        for (var j = 1; j < points.length; j++) {
           ctx.lineTo((points[j].x + this.x) * SCALE, (points[j].y + this.y) * SCALE);
        }
        ctx.lineTo((this.x + points[0].x) * SCALE, (this.y + points[0].y) * SCALE);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
      }

      ctx.restore();
      
      Entity.prototype.draw.call(this, ctx);
    }
    
    var world = {};
    var bodiesState = null;
    var box = null;
    
    function update(animStart) {
      if (isMouseDown) {
        box.mouseDownAt(mouseX, mouseY);
      } else if (box.isMouseDown()) {
        box.mouseUp();
      }
      
      box.update();
      bodiesState = box.getState();
      
      for (var id in bodiesState) {
        var entity = world[id];
        if (entity) entity.update(bodiesState[id]);
      }
    }
    
    var canvas = document.getElementById("c0");
    var ctx = canvas.getContext("2d");
    var canvasWidth = canvas.width;
    var canvasHeight = canvas.height;
    
    function draw() {
      //console.log("d");
      
      ctx.clearRect(0, 0, canvasWidth, canvasHeight);
      for (var id in world) {
        var entity = world[id];
        entity.draw(ctx);
      }
    }
    
    var initialState = [
      {id: "ground", x: canvasWidth / 2 / SCALE, y: canvasHeight/ SCALE, halfHeight: 0.5, halfWidth: canvasWidth / SCALE, color: 'yellow'},
      //{id: "box1", x: 5, y: 6, halfHeight: 1, halfWidth: 1},
      {id: "box2", x: 15, y: 8, halfHeight: 0.5, halfWidth: 0.5},
      {id: "box1", x: 17, y: 8, radius: 1}
    ];
    
    var running = true;
    
    function init() {
      for (var i = 0; i < initialState.length; i++) {
        world[initialState[i].id] = Entity.build(initialState[i]);
      }
      
      box = new bTest(60, false, canvasWidth, canvasHeight, SCALE);
      box.setBodies(world);
      box.addPulleyJoint("box1", "box2", {x:15, y:4}, {x:17, y:4});
      world['pulley'] = new PulleyJoint(world['box1'], world['box2'], {x:15, y:4}, {x:17, y:4});
      
      setTimeout(function() {
        init();
      },1000000);
    }
    
    /* ---- INPUT ----------------------------- */
    var mouseX, mouseY, isMouseDown;
    
    canvas.addEventListener("mousedown", function(e) {
       isMouseDown = true;
       handleMouseMove(e);
       document.addEventListener("mousemove", handleMouseMove, true);
    }, true);
    
    canvas.addEventListener("mouseup", function() {
       document.removeEventListener("mousemove", handleMouseMove, true);
       isMouseDown = false;
       mouseX = undefined;
       mouseY = undefined;
    }, true);
    
    function handleMouseMove(e) {
       mouseX = (e.clientX - canvas.getBoundingClientRect().left) / SCALE;
       mouseY = (e.clientY - canvas.getBoundingClientRect().top) / SCALE;
    };
    
    /* ------------------------------------------ */
    
    document.addEventListener("DOMContentLoaded", function() {
      init();
      
      (function loop(animStart) {
        update(animStart);
        draw();
        requestAnimFrame(loop);
      })();
    }, false);

    </script>



</body>
</html>

